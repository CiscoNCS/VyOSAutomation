---
  - hosts: Test1
    connection: network_cli
    gather_facts: 'no'

    vars_prompt:
    # Phase 1 System Configuration user inputs.
      - name: "hostname"
        prompt: "Enter a Hostname for this router."
        private: no
      - name: "nameservers1"
        prompt: "Enter upstream DNS Server 1."
        private: no
      - name: "nameservers2"
        prompt: "Enter upstream DNS Server 2."
        private: no
      - name: "ntpserver1"
        prompt: "Enter NTP Server 1"
        private: no
      - name: "ntpserver2"
        prompt: "Enter NTP Server 2"
        private: no
      - name: "username"
        prompt: "Add system account as default account (vyos) has been deleted."
        private: no
      - name: "password"
        prompt: "Add system account new password. Which will be used on youre next login."
        private: yes
        confirm: yes
    # Phase 2 System Monitoring user inputs.
      - name: "netflowver"
        prompt: "Type the version of netflow you would like to use."
        private: no
        confirm: yes
      - name: "netflowport"
        prompt: "Type the port of the netflow server it is listening on."
        private: no
      - name: "netflowserver"
        prompt: "Enter the IP of the netflow server"
        private: no

    tasks:
      - name: Phase 1 System Configuration
        vyos_config:
          lines:
          
          - set system host-name "{{ hostname }}"
          - set system name-server "{{ nameservers1 }}"
          - set system name-server "{{ nameservers2 }}"
          - set system ntp server "{{ ntpserver1 }}"
          - set system ntp server "{{ ntpserver2 }}"
          - set system login user {{ username }} authentication plaintext-password {{ password }}

    tasks:
      - name: Phase 2 System Monitoring Netflow v9
        vyos_config:
          line:
          
          - set system flow-accounting enable-egress
          - set system flow-accounting netflow version {{ netflowver }} port {{ netflowport }}
          - set system flow-accounting netflow server {{ netflowserver }}
          - set system flow-accounting netflow sampling-rate 100
          - set system flow-accounting netflow timeout expiry-interval 30



    tasks:
      - name: Cleanup Process
        vyos_config:
          lines:

          - delete system ntp server 0.pool.ntp.org
          - delete system ntp server 1.pool.ntp.org
          - delete system ntp server 2.pool.ntp.org